# ahc048

<br>

順位: 116th

パフォーマンス: 2035

[コンテスト成績証](https://atcoder.jp/users/tawainfer/history/share/ahc048)

<br>

seed: 0000, score: 202074

<img src="images/0000.gif" width="256">

<br>

seed: 0068, score: 102674

<img src="images/0068.gif" width="256">

<br>

## メモ

### 202505300

仕切りは一つも立てない。

ターゲットとなる色に最も近い色のチューブからウェルに1グラム取り出す -> 画伯に差し出す操作を繰り返す。

### 202505310

$T$が小さいケースだと、1つのターゲットを完成させるのに使える平均ターン数が4ターンしかない。

- 2つの絵の具を出して2gにする
- 1gを画伯に差し出す
- 残りの1gを破棄する

といった一連の操作が丁度4ターンで出来るのでとりあえずこれを試す。

多くのケースでスコアは改善したが、絵の具を1g取り出すのに必要なコスト$D$の制約が厳しいケースでは悪化した。

- コスト$D$が大きい -> 絵の具を無駄遣いできない
- 最大ターン数$T$が小さい -> 調合に時間をかけられない(誤差を小さくすることが難しい)

### 202505311

処理内容は`202505310`から変えずに、ゲームの状態を表すPaletteクラスを用意するなど、リファクタリング。

ウェルの判定にはDynamicConnectivityを使用する。

`202505310`と同じ処理内容にもかかわらず明らかに重い。実行速度の改善が必要。

### 202506010

DynamicConnectivityのRemoveメソッドが上手く動いていない。

一旦、Paletteクラスのコンストラクタ内でセルの接続関係は手動で定義。

最初の数手だけ貪欲に最適なパターンを求めて、残りを乱択で埋める...はずだったが乱択のフェーズで一回もスコアが更新されない。

ケースに合わせて時間いっぱい貪欲に最適解を求めているだけの状態。

加えて、スコアが悪化しているケースもある。絵の具のコストがネックになってる気がする。使いすぎ注意。

### 202506011

スコアが悪化していたケースを改善。

一からターゲットに近い色を調合する操作の限界が見えてきた。

一度作った色を全て破棄したりせず、再利用することで絵の具を新しく取り出すコストを減らせるようにしたい。

### 202506030

上手くいってないDynamicConnectivityは諦めて、普通にBFSで連結状態を管理するGridクラスを作って置き換え。

処理は変えてないのでスコアの変化は当然なし。バグもなく置換に成功した模様。

若干、実行時間を短縮できたがまだまだ処理が重い。

サボっていた仕切りを出し入れする部分の処理も実装したので、一度出した絵の具を無闇に廃棄せず再利用できるような操作を考えていきたい。

### 202506031

リファクタリング。

使わなくなったDynamicConnectivityクラスのコードを一掃。

効果がありそうな部分はインライン化する。処理内容は変えずに100~200ms程度の高速化に繋がった。

### 202506050

適当に仕切りを設定していき、ランダムに絵の具を全てのマスにセットしていく。

要望された全ての色の差し出しが完了するまで以下の操作を繰り返す。

- 全てのセルを見て、ターゲットに最も近い色のセルから絵の具を取り出す。(同じウェルに属するセルを何度も見たところで意味はないので高速化の余地あり)

- 現在、盤面に出している絵の具の総量だけでは残りの全てのターゲットを完成させられない場合は、絵の具を取り出したセルに新しい絵の具をランダムにセットする。

いくつかのケースでスコアの改善が見られたが、悪化したケースもあり、相対スコアで見ると最初の方針とほとんど差はない。

盤面に出す絵の具の量を最小限に抑えているため、終盤に盤面から取り出せる色はターゲットの色とはかけ離れたものになっているように見える。

終盤に向かっていく段階で仕切りを破壊して、極端な色が最後まで残らないようにする戦略が考えられる。

ただ、仕切りを下げて異なるウェルが連結になるときの色の混合処理が上手くいっていない。戦略を試すには早急にバグ修正する必要あり。

### 202506051

異なるウェルを合体させるときのバグを修正。

終盤に向かう段階で仕切りを破壊していく戦略も実装。若干スコアが改善。

ただ、依然として相対スコアが低い。どのような傾向のケースで負けているのか分析する必要がある。

### 202506070

PaletteクラスはGridクラスを継承する形に変更。

最適なセルを選ぶのではなく、最適なウェルを選ぶ(ウェルを代表するセルを一つだけ見る)ようにすることで実行速度を多少改善。

### 202506071

数手分の色の混合手順をKD木に保存しておき、実際に絵の具を配置していくタイミングで高速にその結果を取得する。

Greedy1より実行時間の効率が良く誤差が減らせるので、Greedy1で強かったケースのスコアをさらに伸ばすことができた。

しかし、絵の具の使用コストが高いケースではやはり上手くいかない。

ここで、絵の具のコストが重いケースでは、代わりにGreedy2を実行するようにするとある程度バランスの良い結果が出るようになった。

ただ、絵の具を無駄に廃棄しているところが残念。

KD木に溜めた情報を活かしながら、盤面にある絵の具を再利用できるようにしたい。

### 202506072

今までは差し出した後、選択したウェルの絵の具を全て廃棄していたが、これを盤面に残して次のターゲットの作成に向かう。

1~3回程度の少ない調合回数では極端な色が出来上がっていたが、回数を増やして選択する絵の具のバリエーションを増やすと微妙なニュアンスの色が作れる。

盤面に残した微妙なニュアンスの色が意外と再利用できることも分かった。

現時点では、「絵の具を足さずにウェルから取り出す」「KD木の情報を使って空のウェルに最適なパターンを構築する」の2種類の操作しか試せていないので、空のウェルだけでなく絵の具をまだ足せるウェルに補充する操作なども試したい。

### 202506073

実行時間が余っているので時間いっぱい回してみる。スコアは少しだけ改善。

何故かKD木の検索処理が重い気がする。調査の必要あり。

### 202506074

現在の実装だと複数のターンの情報をまとめて保持するKD木を作った場合、検索クエリでmaxTurnが小さい場合に枝刈りが上手く出来ない事が判明した。

全ての情報を持つKD木以外にも、調合に必要な操作回数ごとに管理するKD木を複数構築しておく。

全ての情報から探索する必要がない場合、新しく追加した守備範囲の狭いKD木から検索するようにする。

これで検索処理の重さの対応は済んだが、スコア自体の改善には繋がっていない。

操作の追加を試していく必要がある。

### 202506075

「容量に余裕のあるウェルに絵の具を1g垂らしてから差し出す」操作を加えた。

ほとんどのケースでベストスコアを更新し、全体の評価としてはが1.5倍に。

2桁順位が見えてきた。2,3g加える操作なども試してみたい。

### 202506080

絵の具のコストが高いと新しい絵の具を展開できず、終盤では盤面に残った極端な色しか選択できない。

仕切りを破壊して異なるウェル同士を合体させることで、色の誤差を出来るだけ減らす。

わずかにスコアが改善。

### 202506081

数gウェルに加えてから差し出す操作を追加し、パラメータを弄る。

スコアを伸ばし初の2桁順位。明日の19時まで維持したいけど苦しそう。
